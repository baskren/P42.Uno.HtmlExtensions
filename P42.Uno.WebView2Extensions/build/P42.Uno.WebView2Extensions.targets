<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <Import Project="P42.Uno.WebView2Extensions.Registration.targets" />


  <Target
    Condition="   $(OutputType) != 'Library' AND  '@(WebView2ProjectContentFile)' != ''"
    Name="P42_IncludeWebView2ProjectContentFiles"
    AfterTargets="P42_GenerateWebView2RegistrationCode">


    <Message
      Text="ProjectContentFile: ID[%(UniqueWebView2ProjectContentFile.Identity)] LINK[%(UniqueWebView2ProjectContentFile.Link)] FOLDER[%(UniqueWebView2ProjectContentFile.CSharpRelativeDir)]"
      Importance="high"
      />




    <ItemGroup>

      <AndroidAsset
        Condition="  $(TargetFramework.Contains('android')) "
        Include="@(UniqueWebView2ProjectContentFile)"
        Visible="false"
        Link="Platforms/Android/Assets/WebView2ProjectContentFolders/%(Identity)" />

      <BundleResource
        Condition="  $(TargetFramework.Contains('ios')) "
        Include="@(UniqueWebView2ProjectContentFile)"
        Visible="false"
        Link="Platforms/iOS/Resources/WebView2ProjectContentFolders/%(Identity)" />

      <Content
        Condition="  $(TargetFramework.Contains('windows'))  OR   $(TargetFramework.Contains('desktop'))  "
        Include="@(UniqueWebView2ProjectContentFile)"
        Link="WebView2ProjectContentFolders/%(Identity)"
        Visible="false"
        CopyToOutputDirectory="PreserveNewest" />

      <Content
        Condition="  $(TargetFramework.Contains('wasm')) "
        Include="@(UniqueWebView2ProjectContentFile)"
        Link="%(Identity)"
        Visible="false"
        UnoDeploy="Root"
        CopyToOutputDirectory="PreserveNewest" />


    </ItemGroup>

    <Message
      Condition=" $(TargetFramework.Contains('android')) "
      Text="AndroidAsset: ID[%(AndroidAsset.Identity)]     LINK[%(AndroidAsset.Link)]"
      Importance="High" />
    <Message
      Condition=" $(TargetFramework.Contains('ios'))"
      Text="BundleResource: ID[%(BundleResource.Identity)]     LINK[%(BundleResource.Link)]"
      Importance="High" />
    <Message
      Condition=" $(TargetFramework.Contains('windows'))  OR  $(TargetFramework.Contains('desktop'))  OR  $(TargetFramework.Contains('wasm')) "
      Text="WinDeskWasm Content: ID[%(Content.Identity)]     LINK[%(Content.Link)]"
      Importance="High" />

  </Target>


  <!-- It appears that UNO is handling some Content file types (.jpg and .png for example) differently than other formats, putting those in wwwroot/package_XXX but everything else in wwwroot -->
  <Target
    Name="_P42UnoWebView2ExtensionsWasmProjectContentFiles"
    Condition="$(TargetFramework.Contains('wasm'))  AND  '@(WebView2ProjectContentFile)' != '' "
    AfterTargets="Build">

    <Copy
      SourceFiles="@(UniqueWebView2ProjectContentFile)"
      DestinationFiles="@(UniqueWebView2ProjectContentFile->'$(OutputPath)\wwwroot\%(RelativeDir)%(RecursiveDir)%(Filename)%(Extension)')"
    />

  </Target>


</Project>
